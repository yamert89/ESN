<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="block.css">
    <link rel="stylesheet" href="../../../../libs/ECOTree-master/ECOTree.css">
    <script src="../../../../libs/ECOTree-master/ECOTree.js"></script>
    <script src="../../../../libs/jquery_3.1.0.js"></script>
    <xml:namespace ns="urn:schemas-microsoft-com:vml" prefix="v"/>
    <style>v\:*{ behavior:url(#default#VML);}</style>
    <xml:namespace ns="urn:schemas-microsoft-com:vml" prefix="v" />
    <script>
        $(document).ready(function () {
            createTree();



            $("img").not(".node_plus").click(function () {
               nodePlusOnClick();
            });
        });

        function createTree() {
            myTree = new ECOTree('myTree','myTreeContainer');
            var orgName = window.parent.orgName;
           createSomeNode(0, -1, orgName); //TODO получить имя организации
        }

        function addChild(parent) {
            var name = prompt("Введите название дочернего подразделения", "");
            while (name.length === 0) {
                alert("Назавание не может быть пустым");
                name = prompt("Введите название подраздела", "");
            }
            createSomeNode(Date.now(), parent, name);
        }
        
        function createSomeNode(id, parent, name) {
            var l = (name.length * 14) + 9;
            if (l < 68) l = 68;
            myTree.add(id, parent, name, l);
            myTree.UpdateTree();
            nodePlusOnClick();

        }

        function nodePlusOnClick() {
            var node_pluse = $(".node_plus");
            node_pluse.on("click", function () {
                addChild($(this).parent().parent().attr('id'));
            });

            node_pluse.attr("src", "../../../../plus.png");

        }




    </script>
</head>
<body>
<div id="myTreeContainer"></div>
</body>
</html>
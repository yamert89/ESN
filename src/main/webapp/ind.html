<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="resources/static/index.css">
    <link rel="stylesheet" href="resources/libs/jquery.arcticmodal-0.3/jquery.arcticmodal-0.3.css">
    <link rel="stylesheet" href="resources/libs/jquery.arcticmodal-0.3/themes/dark.css">
    <link rel="stylesheet" href="resources/libs/jquery.arcticmodal-0.3/themes/simple.css">
    <link rel="stylesheet" href="resources/static/center/wall/wall.css">
    <link rel="stylesheet" href="resources/static/contacts/contacts.css">
    <link rel="stylesheet" href="resources/static/tools/tools.css">
    <link rel="stylesheet" href="resources/static/center/storage/storage.css">
    <link rel="stylesheet" href="resources/static/center/chat/private_chat.css">
    <link rel="stylesheet" href="resources/static/center/chat/gen_chat.css">
    <link rel="stylesheet" href="resources/static/center/notes/notes.css">
    <link rel="stylesheet" href="resources/libs/air-datepicker-master/dist/css/datepicker.css">
    <link rel="stylesheet" href="resources/static/center/staff/flowchart/block.css">
    <link rel="stylesheet" href="resources/static/center/calendar/frame_style.css">
    <link rel="stylesheet" href="resources/static/center/groups/groups.css">
    <link rel="stylesheet" href="resources/static/gen.css">

    <script src="libs/jquery_3.1.0.js"></script>
    <script src="resources/libs/jquery.arcticmodal-0.3/jquery.arcticmodal-0.3.min.js"></script>
    <script src="libs/ckeditor/ckeditor.js"></script>
    <script src="resources/static/center/wall/wall.js"></script>
    <script src="resources/static/center/chat/gen_chat.js"></script>
    <script src="resources/static/center/groups/groups.js"></script>


    <script src="resources/libs/air-datepicker-master/dist/js/datepicker.js"></script>
    <script src="resources/static/center/notes/notes.js"></script>



    <script type="text/javascript">
    var myTree = null;
    window.listOfDatesNoted = [];
    $(document).ready(function () {

        $(document).ready(function () {
            $(".btn_load_file").on("change", function () {
                alert($(this).get(0).files[0].name);

            });
        });

        $('.post_add').click(function () {
            showEditor();
        });


        function showEditor() {
            var submit = $(".post_submit");
            try {
                var editor = CKEDITOR.replace('editor');
                /*editor.config.autoParagraph = false;*/
                CKEDITOR.instances.editor.setData('<p></p>');
            } catch (e) {
                /*CKEDITOR.instances.editor.updateElement();
                CKEDITOR.replace('editor');*/
            }


            $(".post_add").css("display", "none");
            submit.css({"display": "inline"});
            submit.click(function () {
                var data = CKEDITOR.instances.editor.getData();
                hideEditor();

                var NAME = ''; //TODO server
                var IMG = ''; //TODO server
                var TIME = getCurrentDate();

                $(".posts").prepend('<div class="post">' +
                    '<div class="message_info_wrapper">' +
                    '<div class="message_info_w">' +
                    '<img src="' + IMG + '" class="person_photo_small">' +
                    '<div class="person_name_w">' + NAME + '</div>' +
                    '<div class="message_time_w">' + TIME + '</div>' +
                    '</div>' +
                    '</div>' + data + '</div');

                //TODO server save
            });
        }




        function hideEditor() {
            var submit = $(".post_submit");
            $("#cke_editor").replaceWith($('.sample_editor'));
            submit.css("display", "none");
            $(".post_add").css("display", "inline");


            /*CKEDITOR.instances.editor.setData( '<p>Some other editor data.</p>', function()
            {
                CKEDITOR.instances.editor.resetDirty();
            } );*/
            CKEDITOR.instances.editor.destroy();

        }

        /*<div class="message_info_wrapper">
            <div class="message_info_w">
            <img src="" class="person_photo_small">
            <div class="person_name_w">Булыгина Мария Ивановна</div>
        <div class="message_time_w">10: 30 21.09.2018</div>
        </div>
        </div>*/

        $(".clear_flowchart").click(function () {
            var resp = confirm("Вы уверены, что хотите удалить текущую структуру и построить её заново?");
            if (!resp) return;
            //TODO Удалить текущую структуру и обновить страницу с родительским нодом
            $(".flowchart_frame")[0].contentWindow.createTree();
        })













    });


    function dateOfNoteColorize() {
        window.listOfDatesNoted.forEach(function (value) {
            var el34 = $(".datepicker--cells").children("[data-date=\'" + value[0] + "\']" +
                "[data-month=\'" + value[1] + "\']" +
                "[data-year=\'" + value[2] + "\']");
            el34.addClass("date_noted");
        });
    }

    function setCurrentDate(el) {
        el.text(getCurrentDate());
    }

    function getCurrentDate() {
        var now = new Date();
        var options = {
            year: 'numeric',
            month: 'numeric',
            day: 'numeric',
            hour: 'numeric',
            minute: 'numeric',
            second: 'numeric'
        };
        return now.toLocaleString('ru', options);
    }




    /*$(function(){
            $('#exampleModal').arcticmodal();

        });*/


</script>

</head>
<header>
    <div class="title" align="center">Name</div>
    <div class="user">
        <span class="user_name">Иванов Иван Иванович</span>
        <img src="" class="user_photo">
    </div>

</header>
<body>
<div class="container">
<div class="tools">
    <div class="tool">Лента</div>
    <div class="tool">Чат</div>
    <div class="tool">Сотрудники</div>
    <div class="tool">Группы</div>
    <div class="tool">Хранилище</div>
    <div class="tool">Заметки</div>
    <div class="tool">Календарь</div>
    <div class="tool">Приложения</div>
    <div class="datepicker-here"></div>

</div>
<div class="center">
    <div class="tree_wrapper">

        <div class="flowchart_wrapper">
            <iframe src="resources/static/center/staff/flowchart/flowchart.html" class="flowchart_frame"></iframe>
            <button class="clear_flowchart">Очистить структуру</button>
        </div>

        <div class="staff_container">

            <table class="person_staff">
                <tr>
                    <td width="100px">
                        <img src="resources/avatars/wom.jpg" class="person_photo_staff"></td>
                    <td valign="middle">
                        <div class="person_point">
                            <div class="person_name_staff">Иванов Иван Иванович</div>
                            <div class="person_position">Главный инженер</div>
                        </div>
                    </td>
                </tr>
            </table>

        </div>
    </div>
</div>
<div class="contacts">
    <iframe src="resources/static/contacts/contacts.html" frameborder="0"></iframe>
</div>

</div>


<!--    <div style="display: none;">
        <div class="box-modal" id="post_modal">
            <div class="box-modal_close arcticmodal-close">закрыть</div>
            <div><textarea class="post_message"></textarea></div>
            <button class="post_submit">Опубликовать</button>
        </div>
    </div>-->
</body>
</html>